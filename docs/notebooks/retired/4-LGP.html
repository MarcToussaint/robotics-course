<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Logic-Geometric Programming: Skeleton Interface &mdash; Robotics Python Library  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Robotics Python Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks.html">2. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../script/script.html">3. Lecture Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../old/old.html">4. Old Material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rai.html">5. rai python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Robotics Python Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">4. Logic-Geometric Programming: Skeleton Interface</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="4.-Logic-Geometric-Programming:-Skeleton-Interface">
<h1>4. Logic-Geometric Programming: Skeleton Interface<a class="headerlink" href="#4.-Logic-Geometric-Programming:-Skeleton-Interface" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>Formally, in papers, a skeleton is defined by the sequence <span class="math notranslate nohighlight">\(a_{1:K}\)</span> of symbolic decisions. Note that, given the decision rules, such a sequence also defines the sequence of logical state <span class="math notranslate nohighlight">\(s_{1:K}\)</span>. Practially, in the code, we define a skeleton to be a simple data structure that captures the relevant information from both, <span class="math notranslate nohighlight">\(a_{1:K}\)</span> and <span class="math notranslate nohighlight">\(s_{1:K}\)</span>.</p></li>
<li><p>A skeleton is a list of tuples <span class="math notranslate nohighlight">\((t_\text{start}, t_\text{end}, \text{literal})\)</span>, where <span class="math notranslate nohighlight">\(t_\text{start}\)</span> denotes the time (actually real-valued phase, but typically the integer k) at which a certain literal becomes true, <span class="math notranslate nohighlight">\(t_\text{end}\)</span> denotes the time when the literal was deleted, and <code class="docutils literal notranslate"><span class="pre">literal</span></code> is a some literal, e.g. <code class="docutils literal notranslate"><span class="pre">(stable</span> <span class="pre">hand</span> <span class="pre">object)</span></code>. In our case, the literals only include symbols (no real-valued constants), the first of which is the predicate, and the others
typically refer to objects.</p></li>
<li><p>The skeleton interface to LGP means that you can define a skeleton, and let the algorithm compute a corresponding path. Note that this does not solve the search over symbolic decisions. It allows you to specify the path constraints on the same abstract level that is used internally for LGP.</p></li>
<li><p>Currently implemented skeleton predicates are:</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>predicate</p></th>
<th class="head"><p>arguments</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>touch</p></td>
<td><p>(obj1, obj2)</p></td>
<td><p>zero distance equality</p></td>
</tr>
<tr class="row-odd"><td><p>above</p></td>
<td><p>(obj, table)</p></td>
<td><p>center of object vertically inside convex table</p></td>
</tr>
<tr class="row-even"><td><p>inside</p></td>
<td><p>(obj, box)</p></td>
<td><p>center of object inside convex box</p></td>
</tr>
<tr class="row-odd"><td><p>impulse</p></td>
<td><p>(obj1, obj2)</p></td>
<td><p>impule exchange equation</p></td>
</tr>
<tr class="row-even"><td><p>stable</p></td>
<td><p>(from, to)</p></td>
<td><p>stable but free (7dof) relation</p></td>
</tr>
<tr class="row-odd"><td><p>stableOn</p></td>
<td><p>(from, to)</p></td>
<td><p>stable constrained (3dof xyphi) relation</p></td>
</tr>
<tr class="row-even"><td><p>dynamic</p></td>
<td><p>(from, to)</p></td>
<td><p>free dynamics and corresponding equation</p></td>
</tr>
<tr class="row-odd"><td><p>dynamicOn</p></td>
<td><p>(from, to)</p></td>
<td><p>constrained 3dof dynamics</p></td>
</tr>
<tr class="row-even"><td><p>liftDownUp</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>push</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>graspSlide</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Generally, a skeleton is translated to a set of objectives (and kinematic switches, and other internal things) for a path or configuration optimization problem. Note that this translation is not unique: In particular, for the same skeleton we can compute different <em>bounds</em>, each of which corresponds to a different optimization problem. In <code class="docutils literal notranslate"><span class="pre">bounds.h</span></code> in the <code class="docutils literal notranslate"><span class="pre">LGP/</span></code> module several mappings from a skeleton to an optimization problem are defined. These differ in terms of the objective set, but
in terms of parameters like the resolution of the path discretization.</p></li>
<li><p>To summarize, in LGP a decision sequence <span class="math notranslate nohighlight">\(a_{1:K}\)</span> maps to a skeleton <span class="math notranslate nohighlight">\(S\)</span> – this mapping is defined by the decision rules which state which literals are created by which decisions (typically defined in <code class="docutils literal notranslate"><span class="pre">fol.g</span></code>). And then the skeleton <span class="math notranslate nohighlight">\(S\)</span> is mapped to a constrained optimization problem (as set of objectives) – this mapping is defined by the bound.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../ry&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">libry</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">K</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="s2">&quot;../test/boxProblem.g&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komo</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">komo_path</span><span class="p">(</span><span class="mf">5.</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">.2</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="s1">&#39;ballR&#39;</span>

<span class="c1"># this is all yet &#39;magic&#39; -&gt; clearer interface</span>
<span class="n">komo</span><span class="o">.</span><span class="n">addTimeOptimization</span><span class="p">();</span>
<span class="n">komo</span><span class="o">.</span><span class="n">makeObjectsFree</span><span class="p">([</span><span class="n">obj</span><span class="p">]);</span>
<span class="n">komo</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">OT</span><span class="o">.</span><span class="n">sos</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="n">FS</span><span class="o">.</span><span class="n">accumulatedCollisions</span><span class="p">)</span>

<span class="n">S</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;dynamicTrans&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;bounce&quot;</span><span class="p">,</span> <span class="s2">&quot;boxBo&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;bounce&quot;</span><span class="p">,</span> <span class="s2">&quot;boxBo&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;bounce&quot;</span><span class="p">,</span> <span class="s2">&quot;boxBo&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;touch&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">]</span> <span class="p">]</span>

<span class="n">komo</span><span class="o">.</span><span class="n">addSkeleton</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komo</span><span class="o">.</span><span class="n">optimize</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komoView</span> <span class="o">=</span> <span class="n">komo</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komoView</span><span class="o">=</span><span class="mi">0</span>
<span class="n">komo</span><span class="o">=</span><span class="mi">0</span>
<span class="n">D</span><span class="o">=</span><span class="mi">0</span>
<span class="n">K</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><br/><br/><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">K</span><span class="o">.</span><span class="n">addFile</span><span class="p">(</span><span class="s2">&quot;../test/lgp-example.g&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We’re creating the same skeleton that’d be created by the decision sequence</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(grasp baxterR stick) (handover baxterR stick baxterL) (hitSlide stickTip redBall table1) (graspSlide baxterR redBall table1)
</pre></div>
</div>
<p>which is a standard demo in the RSS’18 paper</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komo</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">komo_path</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>
<span class="n">komo</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">OT</span><span class="o">.</span><span class="n">sos</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="n">FS</span><span class="o">.</span><span class="n">transAccelerations</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="p">[</span>
<span class="c1">#(grasp baxterR stick)</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;touch&quot;</span><span class="p">,</span> <span class="s2">&quot;baxterR&quot;</span><span class="p">,</span> <span class="s2">&quot;stick&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;stable&quot;</span><span class="p">,</span> <span class="s2">&quot;baxterR&quot;</span><span class="p">,</span> <span class="s2">&quot;stick&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;liftDownUp&quot;</span><span class="p">,</span> <span class="s2">&quot;baxterR&quot;</span><span class="p">],</span>
<span class="c1">#(handover baxterR stick baxterL)</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;touch&quot;</span><span class="p">,</span> <span class="s2">&quot;baxterL&quot;</span><span class="p">,</span> <span class="s2">&quot;stick&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;stable&quot;</span><span class="p">,</span> <span class="s2">&quot;baxterL&quot;</span><span class="p">,</span> <span class="s2">&quot;stick&quot;</span><span class="p">],</span>
<span class="c1">#(hitSlide stickTip redBall table1)</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;touch&quot;</span><span class="p">,</span> <span class="s2">&quot;stickTip&quot;</span><span class="p">,</span> <span class="s2">&quot;redBall&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;impulse&quot;</span><span class="p">,</span> <span class="s2">&quot;stickTip&quot;</span><span class="p">,</span> <span class="s2">&quot;redBall&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;dynamicOn&quot;</span><span class="p">,</span> <span class="s2">&quot;table1&quot;</span><span class="p">,</span> <span class="s2">&quot;redBall&quot;</span><span class="p">],</span>
<span class="c1">#(graspSlide baxterR redBall table1)</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;graspSlide&quot;</span><span class="p">,</span> <span class="s2">&quot;baxterR&quot;</span><span class="p">,</span> <span class="s2">&quot;redBall&quot;</span><span class="p">,</span> <span class="s2">&quot;table1&quot;</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komo</span><span class="o">.</span><span class="n">addSkeletonBound</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">BT</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komo</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komoView</span> <span class="o">=</span> <span class="n">komo</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">komoView</span><span class="o">=</span><span class="mi">0</span>
<span class="n">komo</span><span class="o">=</span><span class="mi">0</span>
<span class="n">D</span><span class="o">=</span><span class="mi">0</span>
<span class="n">K</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Marc Toussaint.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>